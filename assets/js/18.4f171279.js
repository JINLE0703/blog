(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{373:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),a("h3",{attrs:{id:"同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),a("p",[a("strong",[t._v("如果两个 URL 的协议、域名和端口都相同，我们就称这两个 URL 同源")]),t._v("，浏览器默认两个相同的源之间是可以相互访问资源和操作 DOM 的")]),t._v(" "),a("p",[t._v("两个不同的源之间若想要相互访问资源或者操作 DOM，那么会有一套基础的安全策略的制约，即 "),a("strong",[t._v("同源策略")])]),t._v(" "),a("ol",[a("li",[t._v("在 DOM 层面，限制了来自不同源的 JS 脚本对当前 DOM 对象读和写的操作")]),t._v(" "),a("li",[t._v("在数据层面，限制了不同源的站点读取当前站点的 Cookie、IndexDB、LocalStorage 等数据")]),t._v(" "),a("li",[t._v("在网络层面，限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点")])]),t._v(" "),a("h3",{attrs:{id:"jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[t._v("#")]),t._v(" JSONP")]),t._v(" "),a("p",[t._v("原理就是利用 "),a("code",[t._v("<script>")]),t._v(" 标签没有跨域限制，通过 "),a("code",[t._v("<script>")]),t._v(" 标签 src 属性，发送带有callback 参数的 GET 请求，服务端将接口返回数据拼凑到 callback 函数中，返回给浏览器，浏览器解析执行，从而前端拿到 callback 函数返回的数据。")]),t._v(" "),a("p",[t._v("客户端")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSomething")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//do something")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://example.com/index?callback=doSomething"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("服务端")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("doSomething(")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("myJson"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传参")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("strong",[t._v("缺点")]),t._v("：只能发送 GET 请求，安全性差")]),t._v(" "),a("h3",{attrs:{id:"cors-跨域资源共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors-跨域资源共享"}},[t._v("#")]),t._v(" CORS（跨域资源共享）")]),t._v(" "),a("p",[t._v("CORS 需要浏览器和服务器同时支持")]),t._v(" "),a("p",[t._v("浏览器将 CORS 跨域请求分为简单请求和非简单请求")]),t._v(" "),a("p",[t._v("需同时满足以下两个条件，即为简单请求")]),t._v(" "),a("p",[t._v("1、方法为 "),a("code",[t._v("head")]),t._v("、"),a("code",[t._v("get")]),t._v("、"),a("code",[t._v("post")])]),t._v(" "),a("p",[t._v("2、请求 Header 是 "),a("code",[t._v("Accept")]),t._v("、"),a("code",[t._v("Accept-Language")]),t._v("、"),a("code",[t._v("Content-Language")]),t._v("、"),a("code",[t._v("Content-Type")]),t._v("（只限于三个值："),a("code",[t._v("application/x-www-form-urlencoded")]),t._v("、"),a("code",[t._v("multipart/form-data")]),t._v("、"),a("code",[t._v("text/plain")]),t._v("）")]),t._v(" "),a("h4",{attrs:{id:"简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[t._v("#")]),t._v(" 简单请求")]),t._v(" "),a("p",[t._v("浏览器直接发出 CORS 请求，在头信息中增加一个 "),a("code",[t._v("Origin")]),t._v(" 字段，来表明此次请求来自哪个源")]),t._v(" "),a("p",[t._v("服务器根据这个值，决定是否同意这次请求，处理结果分两种情况：")]),t._v(" "),a("ul",[a("li",[t._v("拒绝\n"),a("ul",[a("li",[t._v("如果 Origin 指定的源，不在许可范围内，服务器会返回一个正常的 HTTP 回应")]),t._v(" "),a("li",[t._v("浏览器发现，这个回应的头信息没有包含 "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 字段，就知道出错了，从而抛出一个错误，被 XMLHttpRequest 的 onerror 回调函数捕获")])])]),t._v(" "),a("li",[t._v("同意\n"),a("ul",[a("li",[t._v("如果Origin指定的域名在许可范围内，服务器返回的响应，会多出这个关键的头信息字段 "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v("，它的值要么是请求时的 "),a("code",[t._v("Origin")]),t._v(" ，要么是 *（表示接收任意域名）")]),t._v(" "),a("li",[t._v("同时还有可选字段"),a("code",[t._v("Access-Control-Allow-Credentials")]),t._v("，设置为 "),a("code",[t._v("true")]),t._v(" 时，表示允许发送 "),a("code",[t._v("cookie")]),t._v("，此时 "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 不能为 *，此字段默认为 "),a("code",[t._v("false")])])])])]),t._v(" "),a("h4",{attrs:{id:"非简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求"}},[t._v("#")]),t._v(" 非简单请求")]),t._v(" "),a("p",[t._v("非简单请求是那种对服务器有特殊要求的请求，比如请求方法是 "),a("code",[t._v("put")]),t._v(" 或 "),a("code",[t._v("delete")]),t._v("，或者 "),a("code",[t._v("Content-Type")]),t._v(" 字段的类型是 "),a("code",[t._v("application/json")])]),t._v(" "),a("p",[t._v("非简单请求的 CORS 请求，会在正式通信之前，增加一次 HTTP 查询请求，称为 "),a("strong",[t._v("预检")]),t._v(" 请求")]),t._v(" "),a("p",[t._v("预检的作用在于，确认当前网页所在的域名是否在服务器的许可名单之中、明确可以使用的 HTTP 请求方法和头信息字段；只有在这个请求返回成功的情况下，浏览器才会发出正式的请求")]),t._v(" "),a("p",[t._v("预检使用的方法时 "),a("code",[t._v("options")]),t._v("，此方法是用来询问的，此方法包含以下几个字段")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("Origin")]),t._v("：表示请求源")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Access-Control-Request-Method")]),t._v("：用来表示非简单请求的请求方法")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Access-Control-Request-Headers")]),t._v("：用来表示非简单请求的额外头部，例如自定义头部")])])]),t._v(" "),a("p",[t._v("预检请求的回应包含以下字段")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("Access-Control-Allow-Methods")]),t._v("：表示服务器支持的所有跨域请求方法")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Access-Control-Max-Age")]),t._v("：表示本次预检请求的有效期")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Access-Control-Allow-Headers")]),t._v("：表示服务器支持的所有头信息字段")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Access-Control-Allow-Credentials")]),t._v("：表示 "),a("code",[t._v("cookie")]),t._v(" 的设置")])])]),t._v(" "),a("h3",{attrs:{id:"document-domaim"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document-domaim"}},[t._v("#")]),t._v(" document.domaim")]),t._v(" "),a("p",[t._v("此方案仅限主域相同，子域不同的跨域应用场景。实现原理：两个页面都通过 js 强制设置 "),a("code",[t._v("document.domain = 'example.com'")]),t._v(" ，就实现了同域，可以共享 cookie。")]),t._v(" "),a("h3",{attrs:{id:"postmessage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postmessage"}},[t._v("#")]),t._v(" postMessage")]),t._v(" "),a("p",[t._v("从 H5 开始支持，通过注册监听信息的 Message 事件、调用发送信息的 postMessage 方法，可以实现跨窗口通信")]),t._v(" "),a("h4",{attrs:{id:"发送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发送"}},[t._v("#")]),t._v(" 发送")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("otherWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" targetOrigin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("transfer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("otherWindow --- 对目标窗口的引用")]),t._v(" "),a("p",[t._v("message --- 要发送的消息")]),t._v(" "),a("p",[t._v("targetOrigin --- 限定消息接受范围，一般是字符串或者 URI，星号 * 则意味着不限制")]),t._v(" "),a("h4",{attrs:{id:"接收信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接收信息"}},[t._v("#")]),t._v(" 接收信息")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" origin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addEventListener "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("onmessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attachEvent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("attachEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'onmessage'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onmessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h2",{attrs:{id:"npx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npx"}},[t._v("#")]),t._v(" npx")]),t._v(" "),a("ol",[a("li",[t._v("可以避免安装全局模块，常用于脚手架构建项目\n"),a("ol",[a("li",[t._v("先下载脚手架到临时目录")]),t._v(" "),a("li",[t._v("运行脚手架构建项目")]),t._v(" "),a("li",[t._v("删除脚手架")])])]),t._v(" "),a("li",[t._v("可以用来调用项目内安装的模块")])])])}),[],!1,null,null,null);s.default=e.exports}}]);