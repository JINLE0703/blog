---
title: 浏览器相关
lang: zh-CN
---

## 浏览器发起 HTTP 请求过程

1. 浏览器构建请求行信息，准备发起网路请求
2. 浏览器在缓存中查找是否有请求的文件
   1. 浏览器发现资源存在缓存中，则拦截请求，返回资源副本，并结束请求**（缓解服务器端压力，提升性能，实现快速资源加载）**
   2. 查找失败，则进入网路请求
3. 准备 IP 和端口
   1. 浏览器请求 DNS 返回域名对应的 IP（浏览器提供 DNS 数据缓存服务，可减少一次网络请求）
   2. 获取端口号，http 默认 80 端口，https 默认 443 端口
4. 等待 TCP 队列，Chrome 浏览器同一域名最多 6 个 TCP 连接，超出需排队等待
5. 建立 TCP 连接，三次握手
6. 发送 HTTP 请求，浏览器向服务器发送请求行（请求方法、请求 URI、HTTP 版本协议）和请求头
7. 

## 页面加载过程

#### 从输入 url 到渲染出页面的整个过程

- 加载过程： 
  - DNS解析 ：把域名变成 IP 地址，大型网站不同地区 IP 地址是不一样的
  - 浏览器根据 IP 地址向服务器发起 http 请求 （包括三次握手）
  - 服务器处理 http 请求，并返回给浏览器
- 渲染过程：
  - 浏览器根据 HTML 代码生成 DOM 树
  - 浏览器根据 css 代码生成 CSSOM
  - 将 DOM 树和 CSSOM 整合形成 Render 树（渲染树），只有 DOM 树是无法渲染的，因为有些标签的 css 属性是在 CSSOM 中
  - 浏览器根据 render 树渲染页面
  - 如果遇到 `<script>` 则暂停渲染，优先加载并执行 JS 代码，完成在继续。因为 JS 进程和渲染进程共用一个线程，JS 有可能改变DOM 结构，如果JS代码改变了 DOM 结构，那么如果提前渲染的 DOM 结构将是不正确的
  - 直至 render 树渲染完成

#### window.onload/DOMContentLoaded

`window.onload`：资源全部加载完成才能执行，包括图片

`DOMContentLoaded`：DOM 渲染完成即可，图片可能尚未下载

## 客户端存储

cookie 和 session 都是用来跟踪浏览器用户身份的会话方式。

WebStorage 的目的是克服由 cookie 所带来的一些限制，当数据需要被严格控制在客户端时，不需要持续的将数据发回服务器。

WebStorage 提供了两种 API：localStorage（本地存储）和 sessionStorage（会话存储）。

#### cookie

由服务器生成，保存在客户端。

可设置过期时间，如果不设置将保存在内存中，浏览器关闭就结束，如果设置过期时间，则保存在硬盘中。

浏览器每次请求都会带上 cookie。

存储大小单个 cookie 不超过 4kb。

一般用于存储用于判断用户是否登录的 sessionid 。

#### session

由服务器生成，保存在服务器端。

当服务器收到请求需要创建 session 对象时，首先会检查客户端请求中是否包含 sessionid。如果有 sessionid，服务器将根据该 id 返回对应 session 对象。如果客户端请求中没有 sessionid，服务器会创建新的 session 对象，并把 sessionid 在本次响应中返回给客户端。通常使用 cookie 方式存储 sessionid 到客户端，在交互中浏览器按照规则将 sessionid 发送给服务器。

session 的安全性大于 cookie。

一般用于保存用户登录信息。

#### localStorage

由客户端生成，保存在客户端。

localStorage 的生命周期是永久的，关闭页面或浏览器之后 localStorage 中的数据也不会消失。localStorage 除非主动删除数据，否则数据永远不会消失。

localStorage 的存储大小一般是 5MB。

常用于长期登录（判断用户是否已登录），适合长期保存在本地的数据。

#### sessionStorage

由客户端生成，保存在客户端。

sessionStorage 的生命周期是在仅在当前会话下有效。sessionStorage 引入了一个浏览器窗口的概念，sessionStorage 是在同源的窗口中始终存在的数据。只要这个浏览器窗口没有关闭，即使刷新页面或者进入同源另一个页面，数据依然存在。但是 sessionStorage 在关闭了浏览器窗口后就会被销毁。同时独立的打开同一个窗口同一个页面，sessionStorage 也是不一样的。

sessionStorage 的存储大小一般是 5MB。

常用于敏感账号一次性登录。